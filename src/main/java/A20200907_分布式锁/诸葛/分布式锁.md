
# 分布式锁用Redis还是Zookeeper?看完你就明白了！
>https://www.bilibili.com/video/BV1cV411r7Sg?p=6


## 1.分布式锁场景
    
    秒杀
    抢优惠券
    接口幂等性校验-防重复
    
## 2.秒杀为例
    
    jpg
    
## 3.redission
    
    1.解决以上所有问题
    2.使用，看截图 redission/
    3.redis是单机情况下的，可以正常使用
    
    4.redis是主从结构的，仍然有bug，主节点获取锁还未同步到从节点的时候宕机，切换到从节点，此时新来的线程就回去获取锁，那么等同于原来的锁失效了，会出现超卖问题
        redission无法完全解决锁失效问题
        而zookeeper就不会有锁失效问题
        redission里面的redlock会对所有集群节点加锁，而且涉及到回滚问题，所以丢失了高性能，不如使用zk
        所以建议使用 redission而不是redlock
    
## 4.如何优化-性能提升百倍-分段锁 【视频位置：68:00】

    例如：
    商品1   库存：100
    可以将库存分为10部分，将不同的分段放在不同的redis集群节点中，尽量不要放在同一台redis上，尽管有可能提高性能（类似于分库分表）
    商品1——1  10
    商品1——2  10
    ...
    商品1——10 10
    并发时用户依次消耗分好的库存，性能快速提高 

## 5.使用
    
    1.若要高性能，能接受极小可能锁失效，使用redission
    2.若要一定保证无锁失效问题，使用zk，性能差点
